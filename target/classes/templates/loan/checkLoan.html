<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>审核</title>
    <head th:include="comm::header">    
  </head> 
<body>
<div class="x-nav">

      <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">演示</a>
        <a>
          <cite>导航元素</cite></a>
      </span>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body">
      <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so">
           <input class="layui-input" placeholder="贷款编号" name="lno" id="lno">
          <input class="layui-input" placeholder="贷款姓名" name="pname" id="pname">
           <div class="layui-input-inline" >
              <input type="text"  readonly id="starttime"   placeholder="可选择日期"   class="layui-input" name="starttime">
          </div>
          到
          <div class="layui-input-inline" >
              <input type="text"  readonly id="endtime"   placeholder="可选择日期"   class="layui-input" name=" endtime">
          </div>
          <a class="layui-btn" id="search" onclick="searchUser()" ><i class="layui-icon">&#xe615;</i></a>
        </form>
      </div>
        <xblock>
        <button class="layui-btn"><i class="layui-icon"></i>公积金贷款初审表</button>
  		<span class="x-right" style="color:#000000;" idstyle="line-height:40px">公积金贷款初审信息</span>
      </xblock>
	<table class="layui-hide" id="test" lay-filter="test"></table>
</div>

<!--详情模态框  -->
<div id="motaikuang" style="display: none;">
	<form lay-filter="formTest" class="layui-form">
			<h2 >贷款人信息</h2>
				<div class="layui-form-item" >
				    	<label  class="layui-form-label">
				                 贷款人账号:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="personno" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 贷款人：
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pname" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 性别:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="psex" autocomplete="off" class="layui-input">
							</div>
						</div>
						
						<div class="layui-form-item" >
							<label  class="layui-form-label">
				                 手机号:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pphone" autocomplete="off" class="layui-input">
							</div>
				
				
				
				    	<label  class="layui-form-label">
				                 证件类型:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pcertificate" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 证件号码：
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pnumber" autocomplete="off" class="layui-input">
							</div>
					</div>
					<div class="layui-form-item" >
							<label  class="layui-form-label">
				                 职业:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="psex" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 婚姻状况:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pmarital" autocomplete="off" class="layui-input">
							</div>
				
	
				    	<label  class="layui-form-label">
				                 电子邮件:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pmail" autocomplete="off" class="layui-input">
							</div>
					</div>
					<div class="layui-form-item" >
							<label  class="layui-form-label">
				                 学历：
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pdegree" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 家庭住址:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="paddress" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 单位名称:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="cname" autocomplete="off" class="layui-input">
							</div>
					</div>
					
							<div class="layui-form-item" >
				    	<label  class="layui-form-label">
				                 月收入:
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="lsalay" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 存款：
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="ldeposit" autocomplete="off" class="layui-input">
							</div>
							
					</div>
					<h2>汇缴信息</h2>
					<div class="layui-form-item" >
						<label  class="layui-form-label">
				                公积金余额：
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="pmoney" autocomplete="off" class="layui-input">
							</div>
							
							<label  class="layui-form-label">
				                 最后汇缴日：
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="premitdate" autocomplete="off" class="layui-input">
							</div>
							
								<label  class="layui-form-label">
				                 汇缴状态
				              </label>
				              <div class="layui-input-inline">
							<input disabled name="psname" autocomplete="off" class="layui-input">
							</div>
					</div>
					
				
					<h2>贷款信息</h2>
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                贷款金额：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lmoney" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 贷款期数：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lperiods" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 贷款利率:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lrate" autocomplete="off" class="layui-input">
								</div>
					</div>
					
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                委托银行：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lction" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 操作人：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lname" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 申请日期:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lapplydate" autocomplete="off" class="layui-input">
								</div>
					</div>
					<h2>还款信息</h2>
						<div class="layui-form-item" >
							<label  class="layui-form-label">
					                还款类型：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lrefundtype" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 开户银行：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lopenbank" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 还款人:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lpayment" autocomplete="off" class="layui-input">
								</div>
					</div>
					
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                贷款卡号：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcardno" autocomplete="off" class="layui-input">
								</div>
					</div>
						<h2>购房信息</h2>
						<div class="layui-form-item" >
							<label  class="layui-form-label">
					                房屋类型：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lrefundtype" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 房屋地址：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="laddress" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 房屋面积:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lallarea" autocomplete="off" class="layui-input">
								</div>
					</div>
					
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                证件号码：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lhouseno" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 购房人姓名：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lbuyname" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 买房账户:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lbuycardno" autocomplete="off" class="layui-input">
								</div>
					</div>
					
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                房屋总价：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lhouseprice" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 首付款：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lfirstpay" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 面积单价:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lareaprice" autocomplete="off" class="layui-input">
								</div>
					</div>
					<h2>抵押信息</h2>
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                抵押类型：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcollateraltype" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 抵押人姓名：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcollateralname" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 抵押人身份证号码:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcollateralnumber" autocomplete="off" class="layui-input">
								</div>
					</div>
					
					<div class="layui-form-item" >
							<label  class="layui-form-label">
					                抵押物地址：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcollateraladdress" autocomplete="off" class="layui-input">
								</div>
								
								<label  class="layui-form-label">
					                 抵押物状态：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcollateralstate" autocomplete="off" class="layui-input">
								</div>
								
									<label  class="layui-form-label">
					                 抵押物总价:
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lcollateralacount" autocomplete="off" class="layui-input">
								</div>
					</div>
					
						<div class="layui-form-item" >
							<label  class="layui-form-label">
					                驳回意见：
					              </label>
					              <div class="layui-input-inline">
								<input disabled name="lrejecttext" autocomplete="off" class="layui-input">
								</div>
								
					</div>
		<div class="layui-form-item" align="right">
				<a class="layui-btn"  lay-filter="pass" onclick="firstPass()">通过</a>
				<a class="layui-btn"  lay-filter="reject" id="reject">驳回</a>
          </div>
	</form>
</div>

<!-- 驳回 -->
<div id="rejectText" style="display: none;">

		  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">驳回原因</label>
    <div class="layui-input-block">
      <textarea name="lrejecttext"  id="lrejecttext"  placeholder="请输入内容" class="layui-textarea"></textarea>
    	
    </div>
    <div class="layui-form-item" align="center">
				<a class="layui-btn"  lay-filter="pass" onclick="firstReject()">确认驳回</a>
          </div>
  </div>
</div>
<script type="text/html" id="barDemo">
   <a class="layui-btn layui-btn-xs" lay-event="edit"><i class="layui-icon">&#xe642;</i>待审核</a>
</script>
               
 
<script type="text/javascript" th:inline="none">
//初审驳回
	function firstReject(){
	var personno=$("input[name='personno']").val();
		var lrejecttext=$("#lrejecttext").val();
		layui.use(['layer'], function(){
			layer=layui.layer;
		$.ajax({
			url:"/loan/firstReject",
			data:{personno:personno,lrejecttext:lrejecttext},
			success:function(data){
				layer.alert("驳回请求");
	            location.reload();
			},
			error:function(data){
			}
		});
	});
	
	
}
//初审通过
	function firstPass(){
	var personno=$("input[name='personno']").val();
	layui.use(['layer'], function(){
		layer=layui.layer;
	$.ajax({
		url:"/loan/firstPass",
		data:{personno:personno},
		success:function(data){
			layer.alert("初审通过");
            location.reload();
		},
		error:function(data){
		}	
	});
	});
}

	layui.use(['table','form','element','laydate'], function(){
	  var table = layui.table,
	  laydate=layui.laydate,
	  form=layui.form;
	  
	  //数据获取
	  table.render({
	    elem: '#test'
	    ,url:'/loan/selectLoan'
	    ,title: '贷款审核表'
	    ,cols: [[
	       {type:"numbers",title:'编号'}
	       ,{field:'personno', title: '贷款账号' }
	      ,{field:'pname', title: '贷款人姓名' }
	      ,{field:'lmoney', title: '贷款金额' }
	      ,{field:'lperiods', title: '贷款期数' }
	      ,{field:'lrate', title: '贷款利率' }
	      ,{field:'sname', title: '状态' }
	      ,{field:'lapplydate', title: '申请日期' }
	      ,{fixed: 'right', width: 165, align:'center',title:'操作', toolbar: '#barDemo'}
	    ]]
	    ,page: true
	  });
	  
	  
	  //日期选择1
	     var nowTime = new Date().valueOf();
  		       var start = laydate.render({
  		        elem: '#starttime',
  		        type: 'date',
  		        max: nowTime,
  		        btns: ['clear', 'confirm'],
  		        done: function(value, date){
  		            endMax = end.config.max;
  		            end.config.min = date;
  		            end.config.min.month = date.month -1;
  		        }
  		    });
  		     //日期选择2
  		    var end = laydate.render({
  		        elem: '#endtime',
  		        type: 'date',
  		   		 max: nowTime,
  		        done: function(value, date){
  		            if($.trim(value) == ''){
  		                var curDate = new Date();
  		                date = {'date': curDate.getDate(), 'month': curDate.getMonth()+1, 'year': curDate.getFullYear()};
  		            }
  		            start.config.max = date;
  		            start.config.max.month = date.month -1;
  		        }
  		    })
	  
	  //驳回事件
	  $(document).on('click','#reject',function(){
		   	layer.open({
                type:1,//类型
                area:['700px','180px'],//定义宽和高
                title:'审核信息',//题目
                shadeClose:false,//点击遮罩层关闭
                content: $('#rejectText')//打开的内容
            });	
	  })
	  //监听行工具事件
	  table.on('tool(test)', function(obj){
	    var data = obj.data;
	    	//审核信息
	    	form.val("formTest",{
	    		personno:data.personno,
	    		pname:data.pname,
	    		pphone:data.pphone,
	    		pmail:data.pmail,
	    		psex:data.psex,
	    		pmarital:data.pmarital,
	    		pdegree:data.pdegree,
	    		cname:data.cname,
	    		pcertificate:data.pcertificate,
	    		pnumber:data.pnumber,
	    		paddress:data.paddress,
	    		pmoney:data.pmoney,
	    		premitdate:data.premitdate,
	    		psname:data.psname,
	    		lsalay:data.lsalay,
	    		ldeposit:data.ldeposit,
	    		lmoney:data.lmoney,
	    		lperiods:data.lperiods,
	    		lction:data.lction,
	    		lname:data.lname,
	    		lrate:data.lrate,
	    		lapplydate:data.lapplydate,
	    		lrefundtype:data.lrefundtype,
	    		lopenbank:data.lopenbank,
	    		lcardno:data.lcardno,
	    		lunderwriterno:data.lunderwriterno,
	    		lhousetype:data.lhousetype,
	    		laddress:data.laddress,
	    		lallarea:data.lallarea,
	    		lhouseno:data.lhouseno,
	    		lbuyname:data.lbuyname,
	    		lbuycardno:data.lbuycardno,
	    		lhouseprice:data.lhouseprice,
	    		lfirstpay:data.lfirstpay,
	    		lareaprice:data.lareaprice,
	    		lcollateraltype:data.lcollateraltype,
	    		lcollateralname:data.lcollateralname,
	    		lcollateralnumber:data.lcollateralnumber,
	    		lcollateraladdress:data.lcollateraladdress,
	    		lcollateralstate:data.lcollateralstate,
	    		lcollateralacount:data.lcollateralacount,
	    		lrejecttext:data.lrejecttext,
	    		lpayment:data.lpayment,
	    		psname:data.pstate
	    		
	    	});
	    	//刷新表单数据 使其默认值有效
	    	layui.form.render('select','boardFilter');
	    	//打开模态框
	    	layer.open({
                type:1,//类型
                area:['1000px','600px'],//定义宽和高
                title:'审核信息',//题目
                shadeClose:false,//点击遮罩层关闭
                content: $('#motaikuang')//打开的内容
            });	
	  });
	});
	//模糊查询刷新页面
		function searchUser(){
	  layui.use('table', function(){
		  var table = layui.table;
		  var lno = $("#lno").val();
		  var pname = $("#pname").val();
		  var starttime = $("#starttime").val();
		  var endtime = $("#endtime").val();
		  table.reload('test', {
			  url: '/loan/selectLoan'
			  ,where: {
				  lno:lno,
				  pname:pname,
				  starttime:starttime,
				  endtime:endtime  
			  } //设定异步数据接口的额外参数
			  ,page: {
	  			 	curr: 1 //重新从第 1 页开始
	 			  }
			});
	  });		
	}
</script>
</body>
</html>
