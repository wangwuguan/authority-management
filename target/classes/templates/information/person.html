<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>main.html</title>
    <head th:include="comm::header">    
  </head> 
<body>
<div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="http://www.baidu.com">首页</a>
        <a href="javascript:;">账户信息</a>
        <a>
          <cite>个人信息</cite></a>
      </span>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body">
      <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so">
          <input class="layui-input" placeholder="职工编号" name="pno" id="pno">
          <input class="layui-input" placeholder="职工姓名" name="pname" id="pname">
          <div class="layui-input-inline">
			<input readonly id="starttime" placeholder="开始日期" class="layui-input" name="starttime">
		  </div>
		           到
		  <div class="layui-input-inline" style="margin-right:15px;">
		  	<input readonly id="endtime" placeholder="结束日期" class="layui-input" name=" endtime">
		  </div>
          <a class="layui-btn" id="search" onclick="searchUser()" ><i class="layui-icon">&#xe615;</i></a>
        </form>
      </div>
      <xblock>
        <button class="layui-btn" >公积金管理个人信息表</button>
  		<span class="x-right" idstyle="line-height:40px">公积金管理中心</span>
      </xblock> 
	<table class="layui-hide" id="test" lay-filter="test"></table>
</div>


<!--查看详情模态框-->
<div id="details" style="display: none;">
    <div class="x-body">
         <form class="layui-form layui-col-md12" lay-filter="formTest" method="post">
          <div class="layui-form-item">
          	  <label class="layui-form-label">个人账号</label>
              <div class="layui-input-inline">
		 	 	<input name="pno" autocomplete="off" readonly class="layui-input" style="border-style:none">
	 		  </div>
              <label class="layui-form-label">姓名</label>
              <div class="layui-input-inline">
                  <input name="pname" autocomplete="off" readonly class="layui-input" style="border-style:none">
              </div>
              <label class="layui-form-label">手机号码</label>
              <div class="layui-input-inline">
                  <input name="pphone" autocomplete="off" readonly class="layui-input" style="border-style:none">
              </div>
          </div>
          
           <div class="layui-form-item">
          	  <label class="layui-form-label">公司账号</label>
              <div class="layui-input-inline">
		 	 	<input name="cno" required lay-verify="required" autocomplete="off" readonly class="layui-input" style="border-style:none">
	 		  </div>
              <label class="layui-form-label">公司名</label>
              <div class="layui-input-inline">
                  <input name="cname" autocomplete="off" readonly class="layui-input" style="border-style:none">
              </div>
              <label class="layui-form-label">公司地址</label>
              <div class="layui-input-inline">
                  <input name="csite" autocomplete="off" readonly class="layui-input" style="border-style:none">
           </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">证件类型</label>
             <div class="layui-input-inline">
                  <input name="pcertificate" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">证件号码</label>
             <div class="layui-input-inline">
                  <input name="pnumber" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">学历</label>
             <div class="layui-input-inline">
                  <input name="pdegree" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">性别</label>
             <div class="layui-input-inline">
                  <input name="psex" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">电子邮箱</label>
             <div class="layui-input-inline">
                  <input name="pmail" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">婚姻状况</label>
             <div class="layui-input-inline">
                  <input name="pmarital" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">家庭住址</label>
             <div class="layui-input-inline">
                  <input name="paddress" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">个人缴纳公积金比例(%)</label>
             <div class="layui-input-inline">
                  <input name="cdeposits" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">公司缴纳公积金比例(%)</label>
             <div class="layui-input-inline">
                  <input name="cdeposit" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">公司每月缴纳公积金(元)</label>
             <div class="layui-input-inline">
                  <input name="" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">缴存基数(元)</label>
             <div class="layui-input-inline">
                  <input name="pbasenum" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">公积金余额(元)</label>
             <div class="layui-input-inline">
                  <input name="pmoney" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">个人每月缴纳公积金(元)</label>
             <div class="layui-input-inline">
                  <input name="" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">开户人</label>
             <div class="layui-input-inline">
                  <input name="pname" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">开户时间</label>
             <div class="layui-input-inline">
                  <input name="ptime" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label class="layui-form-label">开户银行</label>
             <div class="layui-input-inline">
                  <input name="pbank" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
      </form>
    </div>
</div>

<!--编辑模态框-->
<div id="edit" style="display: none;">
    <div class="x-body">
        <form class="layui-form layui-col-md12 " lay-filter="formTest" >  
        	<input type="hidden" name="pid" />
        	<!-- 公司信息 -->
        	<div class="layui-form-item">
          		  <label class="layui-form-label">公司账号</label>
	              <div class="layui-input-inline">
			 	 	<input name="cno" autocomplete="off" readonly class="layui-input" style="border-style:none" >
		 		  </div>
	              <label class="layui-form-label">公司名</label>
	              <div class="layui-input-inline">
	                  <input name="cname" autocomplete="off" readonly class="layui-input" style="border-style:none" >
	              </div>
	        </div>
	        
	        <div class="layui-form-item">
	        	  <label for="pno" class="layui-form-label">个人账号</label>
	              <div class="layui-input-inline">
			 	 	<input name="pno" autocomplete="off" readonly class="layui-input" style="border-style:none" >
		 		  </div>
	        	  <label for="pno" class="layui-form-label">个人账号</label>
	              <div class="layui-input-inline">
			 	 	<input name="pno" autocomplete="off" readonly class="layui-input" style="border-style:none" >
		 		  </div>
	        </div>
	        
	        <div class="layui-form-item">
          	  	  <label for="pname" class="layui-form-label"><span class="x-red">*</span>姓名</label>
	              <div class="layui-input-inline">
	                  <input name="pname" autocomplete="off" lay-verify="required|username" class="layui-input " >
	              </div>
	              <label for="pphone" class="layui-form-label"><span class="x-red">*</span>手机号码</label>
	              <div class="layui-input-inline">
	                  <input name="pphone" autocomplete="off" lay-verify="required|phone" class="layui-input " >
	              </div>
          	</div>
          <!-- 1、已办理住房公积金的在职员工;
			   2、职工个人姓名、证件类型、证件号、储蓄类型、储蓄开户行、储蓄账号发生变化。 -->
          <div class="layui-form-item">
	             <label class="layui-form-label">证件类型</label>
	             <div class="layui-input-inline layui-form" lay-filter="selFilter">
		              <select name="pcertificate" id="pcertificate" autocomplete="off"></select>
         		 </div>
	             <label class="layui-form-label"><span class="x-red">*</span>证件号码</label>
	             <div class="layui-input-inline">
	                  <input name="pnumber" autocomplete="off" class="layui-input" lay-verify="required|identity" >
	             </div>
          </div>
          
          <div class="layui-form-item">
		     <label class="layui-form-label">性别</label>
		     <div class="layui-input-inline layui-form">
		      	 <input type="radio" name="psex" value="男" title="男" >
		      	 <input type="radio" name="psex" value="女" title="女">
		     </div>
             <label  class="layui-form-label"><span class="x-red">*</span>电子邮箱</label>
             <div class="layui-input-inline">
                  <input name="pmail" autocomplete="off" class="layui-input" lay-verify="required|myEmail">
             </div>
          </div>
          
          <div class="layui-form-item">
             <label  class="layui-form-label"><span class="x-red">*</span>婚姻状况</label>
             <div class="layui-input-inline">
                  <input name="pmarital" autocomplete="off" class="layui-input" lay-verify="required">
             </div>
             <label class="layui-form-label">学历</label>
             <div class="layui-input-inline layui-form" lay-filter="selFilter">
                  <select name="pdegree" id="pdegree" autocomplete="off"></select>
             </div>
          </div>
          
          <div class="layui-form-item">
          	 <label  class="layui-form-label"><span class="x-red">*</span>家庭住址</label>
             <div class="layui-input-inline">
                  <input name="paddress" autocomplete="off" class="layui-input" lay-verify="required">
             </div>
             <label  class="layui-form-label"></label>
             <div class="layui-input-inline"></div>
          </div>
          
          <div class="layui-form-item">
	           <label for="L_repass" class="layui-form-label"></label>
               <div class="layui-input-inline" >
               		<input class="layui-btn" id="btnSave2" lay-filter="update" lay-submit="" type="submit" value="确认修改" />
	      	   </div>
	      </div>
        </form>
    </div>
</div>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit"><i class="layui-icon">&#xe642;</i>编辑</a>
  <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="details"><i class="layui-icon">&#xe60a;</i>详情</a>
</script>            

<script type="text/javascript" th:inline="none">
	layui.use(['table','form','element','laydate'], function(){
	  var table = layui.table,
	  laydate = layui.laydate,
	  form = layui.form,
	  element = layui.element;
	  
	  //数据获取
	  table.render({
	    elem: '#test'
	    ,url:'/personal/findPerson'
	    ,title: '公积金管理单位信息表'
	    ,cols: [[
	     	{type: 'numbers', title: '编号',fixed: 'left'},
	      	{field:'pno', title: '个人公积金账号' , sort: true },
	      	{field:'pname', title: '姓名' },
	      	{field:'pnumber', title: '证件号' },
	      	{field:'psex', title: '性别' },
	      	{field:'pmarital', title: '婚姻状况' },
	      	{field:'pmoney', title: '公积金余额' },
	      	{field:'pstate', title: '当前状态' },
	      	{field:'ptime', title: '开户时间' },
	      	{fixed: 'right', title: '操作', width: 180, align:'center', toolbar: '#barDemo'}
	    ]]
	    ,page: true
	  });
	  
	//日期选择1
	  var nowTime = new Date().valueOf();      
	  var start = laydate.render({
		        elem: '#starttime',
		        type: 'date',
		        max: nowTime,
		        btns: ['clear', 'confirm'],
		        done: function(value, date){
		            endMax = end.config.max;
		            end.config.min = date;
		            end.config.min.month = date.month-1;
		        }
		    });
	    //日期选择2
	    var end = laydate.render({
	        elem: '#endtime',
	        type: 'date',
	   		 max: nowTime,
	        done: function(value, date){
	            if($.trim(value) == ''){
	                var curDate = new Date();
	                date = {'date': curDate.getDate(), 'month': curDate.getMonth()+1, 'year': curDate.getFullYear()};
	            }
	            start.config.max = date;
	            start.config.max.month = date.month-1;
	        }
	    });
	  
	  //加载学历下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectDegree",
		  type:"post",
		  dataType:"json",
		  success:function(data){
			 /* layer.alert(JSON.stringify(data)); */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].pdegreeid+"'>"+data[i].degreename+"</option>";
			 }
			 //拼接到下拉框中
			 $("#pdegree").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });  

	  //加载证件类型下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectCertificate",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].cetid+"'>"+data[i].cetname+"</option>";
			 }
			 //拼接到下拉框中
			 $("#pcertificate").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });  
	  
	  //监听行工具事件
	  table.on('tool(test)', function(obj){
	    var data = obj.data;
	    if(obj.event === 'edit'){
	    	$("[name='pcertificate']").val(data.pcertificate);//证件类型（id值）
	    	$("[name='pdegree']").val(data.pdegree);//学历（id值）
	    	$("input[name='psex'][value='女']").attr("checked", data.psex == '女' ? true : false);
            $("input[name='psex'][value='男']").attr("checked", data.psex == '男' ? true : false);
            /* $("[name='psex']").val(data.psex);//性别 */
            $("[name='pid']").val(data.pid);//个人公积金id
            $("[name='pno']").val(data.pno);//个人公积金账号
	    	$("[name='pname']").val(data.pname);//姓名
	    	$("[name='pphone']").val(data.pphone);//手机号
	    	$("[name='cno']").val(data.cno);//单位公积金账号
	    	$("[name='cname']").val(data.cname);//单位名称
	    	$("[name='csite']").val(data.csite);//单位地址
	    	$("[name='pnumber']").val(data.pnumber);//证件号
	    	$("[name='pmail']").val(data.pmail);//邮箱
	    	$("[name='pmarital']").val(data.pmarital);//婚姻状况
	    	$("[name='paddress']").val(data.paddress);//家庭住址
	    	$("[name='cdeposits']").val(data.cdeposits);//个人缴纳公积金比例(%)
	    	$("[name='cdeposit']").val(data.cdeposit);//单位缴纳公积金比例(%)
	    	$("[name='pbasenum']").val(data.pbasenum);//缴存基数(元)
	    	$("[name='pmoney']").val(data.pmoney);//公积金余额(元)
	    	$("[name='ptime']").val(data.ptime);//开户时间
	    	$("[name='pbank']").val(data.bname);//开户银行
	    	$("[name='pstateid']").val(data.pstateid);//账户状态
	    	//刷新表单数据 使其默认值有效
	    	layui.form.render(); //更新全部
	    	//打开模态框
	    	layer.open({
                type:1,//类型
                area:[ '700px','520px'],//定义宽和高
                title:'编辑个人详细信息',//题目
                shadeClose:false,//点击遮罩层关闭
                content: $('#edit')//打开的内容
            });	  
	      } else if(obj.event === 'details'){
		      layer.open({
	              type:2,//类型
	              content: "/personal/toFindPersonById?pid=" + data.pid,
	              area:['1020px','600px'],//定义宽和高
	              title:'查看详情',//题目
	              shadeClose:false,//点击遮罩层关闭
	          });	
	      }
	    
	  });
	  
	  //监听修改提交
	  form.on('submit(update)', function(data){ 
		    // * 整合表单数据
		    var formData = data.field;
		    alert(JSON.stringify(data.field));
		    //发异步，把数据提交
		    $.ajax({
          	url:"/information/updatePerson",
          	data:formData,
          	type:"post",
          	success:function(datas){
          		if (datas=="success") {
          			layer.close(layer.index);
                    table.reload("test");
                    layer.msg("修改成功");	
          		} else {
          			layer.msg("修改失败");	
          		}
          	},
          	error:function(){
          		layer.msg("添加错误", {icon: 6});
          	}
          });
          //必不可少
          return false;
        });
      
	});
	
	//模糊查询刷新页面
	function searchUser(){
	  layui.use('table', function(){
		  var table = layui.table;
		  var pno = $("#pno").val();
		  var pname = $("#pname").val();
		  var starttime = $("#starttime").val();
		  var endtime = $("#endtime").val();
		  table.reload('test', {
			  url: '/personal/findPerson'
			  ,where: {
				  pno:pno,
				  pname:pname,
				  starttime:starttime,
				  endtime:endtime
			  } //设定异步数据接口的额外参数
			  ,page: {
	  			 	curr: 1 //重新从第 1 页开始
	 			  }
			});
	  });		
	}
	
</script>
</body>
</html>
