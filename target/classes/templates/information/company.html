<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>main.html</title>
    <head th:include="comm::header">    
  </head> 
<body>
<div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="http://www.baidu.com">首页</a>
        <a href="javascript:;">账户信息</a>
        <a>
          <cite>单位信息</cite></a>
      </span>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body">
      <div class="layui-row">
        <form class="layui-form layui-col-md12 x-so">
          <input class="layui-input" placeholder="单位编号" name="cno" id="cno">
          <input class="layui-input" placeholder="单位名称" name="cname" id="cname">
          <div class="layui-input-inline">
			<input readonly id="starttime" placeholder="开始日期" class="layui-input" name="starttime">
		  </div>
		           到
		  <div class="layui-input-inline" style="margin-right:15px;">
		  	<input readonly id="endtime" placeholder="结束日期" class="layui-input" name=" endtime">
		  </div>
          <a class="layui-btn" id="search" onclick="searchUser()" ><i class="layui-icon">&#xe615;</i></a>
        </form>
      </div>
      <xblock>
        <button class="layui-btn" >公积金管理单位信息表</button>
  		<span class="x-right" idstyle="line-height:40px">公积金管理中心</span>
      </xblock> 
	<table class="layui-hide" id="test" lay-filter="test"></table>
</div>

<!--查看详情模态框-->
<div id="details" style="display: none;">
    <div class="x-body">
         <form class="layui-form layui-col-md12" lay-filter="formTest" method="post">
          <div class="layui-form-item">
          	  <label for="cno" class="layui-form-label">单位公积金账号</label>
              <div class="layui-input-inline">
		 	 	<input name="pno" required lay-verify="required" autocomplete="off" readonly class="layui-input" style="border-style:none">
	 		  </div>
              <label for="pname" class="layui-form-label">单位名称</label>
              <div class="layui-input-inline">
                  <input type="text" name="pname" autocomplete="off" readonly class="layui-input" style="border-style:none">
              </div>
              <label for="pphone" class="layui-form-label">手机号码</label>
              <div class="layui-input-inline">
                  <input type="text" id="pphone" name="pphone" autocomplete="off" readonly class="layui-input" style="border-style:none">
              </div>
          </div>
          
           <div class="layui-form-item">
          	  <label for="cno" class="layui-form-label">公司账号</label>
              <div class="layui-input-inline">
		 	 	<input name="cno" required lay-verify="required" autocomplete="off" readonly class="layui-input" style="border-style:none">
	 		  </div>
              <label for="cname" class="layui-form-label">公司名</label>
              <div class="layui-input-inline">
                  <input type="text" id="cname" name="cname" autocomplete="off" readonly class="layui-input" style="border-style:none">
              </div>
              <label for="csite" class="layui-form-label">公司地址</label>
              <div class="layui-input-inline">
                  <input type="text" id="csite" name="csite" autocomplete="off" readonly class="layui-input" style="border-style:none">
           </div>
          </div>
          
          <div class="layui-form-item">
           <label for="pcertificate" class="layui-form-label">证件类型</label>
             <div class="layui-input-inline">
                  <input type="text" id="pcertificate" name="pcertificate" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pnumber" class="layui-form-label">证件号码</label>
             <div class="layui-input-inline">
                  <input type="text" id="pnumber" name="pnumber" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pdegree" class="layui-form-label">学历</label>
             <div class="layui-input-inline">
                  <input type="text" id="pdegree" name="pdegree" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label  class="layui-form-label">性别</label>
             <div class="layui-input-inline">
                  <input type="text" id="pcertificate" name="psex" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label  class="layui-form-label">电子邮箱</label>
             <div class="layui-input-inline">
                  <input type="text" id="pmail" name="pmail" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label  class="layui-form-label">婚姻状况</label>
             <div class="layui-input-inline">
                  <input type="text" id="pmarital" name="pmarital" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label  class="layui-form-label">家庭住址</label>
             <div class="layui-input-inline">
                  <input type="text" id="paddress" name="paddress" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label for="pcertificate" class="layui-form-label">个人缴纳公积金比例(%)</label>
             <div class="layui-input-inline">
                  <input type="text" id="cdeposits" name="cdeposits" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pnumber" class="layui-form-label">公司缴纳公积金比例(%)</label>
             <div class="layui-input-inline">
                  <input type="text" id="cdeposit" name="cdeposit" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pdegree" class="layui-form-label">公司每月缴纳公积金(元)</label>
             <div class="layui-input-inline">
                  <input type="text" id="" name="" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label class="layui-form-label">缴存基数(元)</label>
             <div class="layui-input-inline">
                  <input type="text" id="pbasenum" name="pbasenum" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pnumber" class="layui-form-label">公积金余额(元)</label>
             <div class="layui-input-inline">
                  <input type="text" id="pmoney" name="pmoney" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pdegree" class="layui-form-label">个人每月缴纳公积金(元)</label>
             <div class="layui-input-inline">
                  <input type="text" id="" name="" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
          
          <div class="layui-form-item">
           <label for="pcertificate" class="layui-form-label">开户人</label>
             <div class="layui-input-inline">
                  <input type="text" id="pname" name="pname" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pnumber" class="layui-form-label">开户时间</label>
             <div class="layui-input-inline">
                  <input type="text" id="ptime" name="ptime" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
             <label for="pdegree" class="layui-form-label">开户银行</label>
             <div class="layui-input-inline">
                  <input type="text" id="pbank" name="pbank" autocomplete="off" readonly class="layui-input" style="border-style:none">
             </div>
          </div>
      </form>
    </div>
</div>

<!--编辑模态框-->
<div id="edit" style="display: none;">
    <div class="x-body">
        <form class="layui-form layui-col-md12 " lay-filter="formTest" >
        	  <input type="hidden" name="cid" />
	          <div class="layui-form-item">
	          	  <label class="layui-form-label">公司账号</label>
	              <div class="layui-input-inline">
			 	 	<input name="cno" autocomplete="off" class="layui-input" readonly style="border-style:none" />
		 		  </div>
	              <label class="layui-form-label">机构代码</label>
	              <div class="layui-input-inline">
	                  <input name="cinstitution" autocomplete="off" class="layui-input" readonly style="border-style:none" />
	              </div>
	              <label class="layui-form-label"><span class="x-red">*</span>单位名称</label>
	              <div class="layui-input-inline">
	                  <input name="cname" autocomplete="off" lay-verify="username|required" class="layui-input" />
	              </div>
	          </div>
	          
	          <div class="layui-form-item">
	          	  <label class="layui-form-label"><span class="x-red">*</span>法人代表名称</label>
	              <div class="layui-input-inline">
	                  <input name="clegal" autocomplete="off" lay-verify="username|required" class="layui-input" />
	              </div>
	              <label class="layui-form-label">法人证件类型</label>
	              <div class="layui-input-inline layui-form" >
		               <select name="ccertificate" id="ccertificate" autocomplete="off"></select>
         		  </div>
         		  <label class="layui-form-label"><span class="x-red">*</span>法人证件号码</label>
	              <div class="layui-input-inline">
	                  <input name="cnumber" autocomplete="off" lay-verify="identity|required" class="layui-input" />
	              </div>
	          </div>
	          
	          <div class="layui-form-item">
	              <label class="layui-form-label">单位类型</label>
	              <div class="layui-input-inline layui-form" >
		               <select name="ctype" id="ctype" autocomplete="off"></select>
         		  </div>
	              <label class="layui-form-label">所属行业</label>
	              <div class="layui-input-inline layui-form" >
		               <select name="cindustry" id="cindustry" autocomplete="off"></select>
         		  </div>
	              <label class="layui-form-label">隶属关系</label>
	              <div class="layui-input-inline layui-form" >
		               <select name="crelation" id="crelation" autocomplete="off"></select>
         		  </div>
	          </div>
	          
	          <div class="layui-form-item">
	              <label class="layui-form-label">经济类型</label>
	              <div class="layui-input-inline layui-form" >
		               <select name="ceconomic" id="ceconomic" autocomplete="off"></select>
         		  </div>
         		  <label class="layui-form-label">受托银行</label>
	              <div class="layui-input-inline layui-form" >
		               <select name="cbanks" id="cbanks" autocomplete="off"></select>
         		  </div>
         		  <label class="layui-form-label"><span class="x-red">*</span>月发薪日</label>
	              <div class="layui-input-inline">
	                  <input name="cmonth" autocomplete="off" lay-verify="required" class="layui-input" />
	              </div>
	          </div>
	          <div class="layui-form-item" >
	         	 <center>
	               <label for="L_repass" class="layui-form-label"></label>
	               <input class="layui-btn" id="btnSave2" lay-filter="update" lay-submit="" type="submit" value="确认修改" />
	        	 </center>
        	 </div>
        </form>
    </div>
</div>

<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="edit"><i class="layui-icon">&#xe642;</i>编辑</a>
  <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="details"><i class="layui-icon">&#xe60a;</i>详情</a>
</script>            

<script type="text/javascript" th:inline="none">
	layui.use(['table','form','element','laydate'], function(){
	  var table = layui.table,
	  laydate = layui.laydate,
	  form = layui.form,
	  element = layui.element;
	  
	  //数据获取
	  table.render({
		/* id:"uid",//可以在这里设置需要隐藏的列的字段名，如果是要隐藏多列的话这样写 id:'id,sex' */
	    elem: '#test'
	    ,url:'/company/selectCompany'
	    ,title: '公积金管理单位信息表'
	    ,cols: [[
		   {type: 'numbers', title: '编号',fixed: 'left'},
	       {field:'cno', title: '公司公积金账号' },
           {field:'cname', title: '公司名称' },
           {field:'cdeposit', title: '单位缴存比例(%)' },
           {field:'cdeposits', title: '个人缴存比例(%)' },
           {field:'cbalanc', title: '单位账户余额' },
           {field:'cdate', title: '开户日期' },
           {fixed: 'right', title: '操作', width: 180, align:'center', toolbar: '#barDemo'}
	    ]]
	    ,page: true
	  });
	  
	  //日期选择1
	  var nowTime = new Date().valueOf();      
	  var start = laydate.render({
		        elem: '#starttime',
		        type: 'date',
		        max: nowTime,
		        btns: ['clear', 'confirm'],
		        done: function(value, date){
		            endMax = end.config.max;
		            end.config.min = date;
		            end.config.min.month = date.month-1;
		        }
		    });
	    //日期选择2
	    var end = laydate.render({
	        elem: '#endtime',
	        type: 'date',
	   		 max: nowTime,
	        done: function(value, date){
	            if($.trim(value) == ''){
	                var curDate = new Date();
	                date = {'date': curDate.getDate(), 'month': curDate.getMonth()+1, 'year': curDate.getFullYear()};
	            }
	            start.config.max = date;
	            start.config.max.month = date.month-1;
	        }
	    });
	  
	  //加载证件类型下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectCertificate",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].cetid+"'>"+data[i].cetname+"</option>";
			 }
			 //拼接到下拉框中
			 $("#ccertificate").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });
	  
	  //加载公司类型下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectCompanyType",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].ctid+"'>"+data[i].ctname+"</option>";
			 }
			 //拼接到下拉框中
			 $("#ctype").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });
	  
	  //加载所属行业下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectIndustry",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].iid+"'>"+data[i].iname+"</option>";
			 }
			 //拼接到下拉框中
			 $("#cindustry").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });
	  
	  //加载隶属关系下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectRelation",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].reid+"'>"+data[i].rename+"</option>";
			 }
			 //拼接到下拉框中
			 $("#crelation").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });
	  
	  //加载隶属关系下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectEconomicType",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].etid+"'>"+data[i].etname+"</option>";
			 }
			 //拼接到下拉框中
			 $("#ceconomic").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });
	  
	  //加载受托银行下拉框中的数据
	  $.ajax({
		  url:"/combobox/selectBank",
		  type:"post",
		  dataType:"json",
		  async:false,
		  success:function(data){
			 /* layer.alert(JSON.stringify(data));  */
			 var list = "";
			 for (var i = 0; i < data.length; i++) {
				list+="<option value='"+data[i].bid+"'>"+data[i].bname+"</option>";
			 }
			 //拼接到下拉框中
			 $("#cbanks").append(list);
			 form.render();
		  },
		  error:function(data){
			  layer.msg("错误");
		  }
	  });
	  
	  //监听行工具事件
	  table.on('tool(test)', function(obj){
	    var data = obj.data;
	    if(obj.event === 'edit'){
	    	  /* select */
	    	  $("[name='ctype']").val(data.ctype);//单位类型(id值)
	    	  $("[name='cindustry']").val(data.cindustry);//所属行业
	    	  $("[name='crelation']").val(data.crelation);//隶属关系
		      $("[name='ceconomic']").val(data.ceconomic);//经济类型
		      
	    	  $("[name='cid']").val(data.cid);//单位id
		      $("[name='cno']").val(data.cno);//单位公积金账号
		      $("[name='cname']").val(data.cname);//单位名称
		      $("[name='cinstitution']").val(data.cinstitution);//机构代码
		      $("[name='csite']").val(data.csite);//单位地址
		      $("[name='cmonth']").val(data.cmonth);//月发薪日
		      $("[name='cbanks']").val(data.cbanks);//受托银行
		      $("[name='clegal']").val(data.clegal);//法人代表名称
		      $("[name='ccertificate']").val(data.ccertificate);//法人证件类型
		      $("[name='cnumber']").val(data.cnumber);//法人证件号码
		      
		      $("[name='cdeposit']").val(data.cdeposit);//单位缴存比例
		      $("[name='cdeposits']").val(data.cdeposits);//个人缴存比例
		      $("[name='stateid']").val(data.stateid);//账号状态
		      $("[name='ctime']").val(data.ctime);//公司成立日期
		      $("[name='cdate']").val(data.cdate);//开户时间
		      $("[name='cbank']").val(data.cbank);//开户银行
		      $("[name='cdate']").val(data.cdate);//开户日期
		      $("[name='cbankno']").val(data.cbankno);//开户银行账号
		      $("[name='userid']").val(data.userid);//业务操作人
		      $("[name='cbalanc']").val(data.cbalanc);//单位账号余额
		      $("[name='cputsno']").val(data.cputsno);//缴存人数（单位人数）
		      $("[name='cback']").val(data.cback);//驳回理由
		      $("[name='coperator']").val(data.coperator);//经办人姓名
		      $("[name='cphone']").val(data.cphone);//经办人手机号
		      $("[name='ccertificates']").val(data.ccertificate);//经办人证件类型
		      $("[name='cnumbers']").val(data.cnumbers);//经办人证件号码
		      //刷新表单
		      form.render();
		      //打开模态框
		    	layer.open({
	                type:1,//类型
	                area:['1020px','410px'],//定义宽和高
	                title:'编辑个人详细信息',//题目
	                shadeClose:false,//点击遮罩层关闭
	                content: $('#edit')//打开的内容
	            });	  	
		    } else if(obj.event === 'details'){
		      $("[name='cid']").val(data.cid);
		      //alert(data.cid);
		      layer.open({
	              type:2,//类型
	              content: "/company/toCompanyInfoById?cid=" + data.cid,
	              area:['1000px','600px'],//定义宽和高
	              title:'查看详情',//题目
	              shadeClose:false,//点击遮罩层关闭
	          });	
		    }
	  });
	  
	  //监听修改提交
	  form.on('submit(update)', function(data){ 
		    //整合表单数据
		    var formData = data.field;
		    //发异步，把数据提交
		    $.ajax({
          	url:"/information/updateCompany",
          	data:formData,
          	type:"post",
          	success:function(datas){
          		if (datas=="success") {
          			layer.closeAll();
                    table.reload("test");
                    layer.msg("修改成功");	
          		}
          	},
          	error:function(){
          		layer.msg("添加错误", {icon: 6});
          	}
          });
          //必不可少
          return false;
        });
      
	});
	
	//模糊查询刷新页面
	function searchUser(){
	  layui.use('table', function(){
		  var table = layui.table;
		  var cno = $("#cno").val();
		  var cname = $("#cname").val();
		  var starttime = $("#starttime").val();
		  var endtime = $("#endtime").val();
		  table.reload('test', {
			  url: '/company/selectCompany'
			  ,where: {
				  cno:cno,
				  cname:cname,
				  starttime:starttime,
				  endtime:endtime
			  } //设定异步数据接口的额外参数
			  ,page: {
	  			 	curr: 1 //重新从第 1 页开始
	 			  }
			});
	  });		
	}
	
</script>
</body>
</html>
